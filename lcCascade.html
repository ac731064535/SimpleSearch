<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        div.cascader{
        	position: relative;
        	text-align: center;
        	/*background: red*/
        }
    	ul{
    		position: absolute;
    		top: 50px;
    		display: inline;
    		padding: 0;
    		margin-top: 0;
    		border: darkgray solid thin;
    	}
    	li{
    		list-style-type: none;
            padding-left: 0px;
    	}
    	.selected{
    		background: #f0f0f0;
    	}
    </style>
</head>
<body>
	<div class="cascader">
	</div>
<script type="text/javascript" src="location.js"></script>
<script>
	var llocation = llocation;

	new LcCascader('div.cascader',llocation);

	function LcCascader(div,data){
		this.data = data;
		this.div = document.querySelectorAll(div)[0];
		this.resLocation = ['','',''];

		var tarIndex1,
		    tarIndex2,
		    tarIndex3;
		var lastUl0Index = 0;
		var lastUl1Index = 0;

		var input = document.createElement('input');
		this.div.appendChild(input);

		for(let i = 0; i < 3; i++){
			let ul = document.createElement('ul');
			ul.index = i;
			console.log(ul);
			ul.style.width = 150 + 'px';
			ul.style.top = input.offsetTop + input.offsetHeight + 'px';
			ul.style.left = input.offsetLeft + 150*i + 'px';
			this.div.appendChild(ul);
		}

		this.init = function(){
			clickInput(input);
		    clickUl(this.div);

		}
        function clickInput(input){
            var _this = this;
            input.addEventListener('click',function(){
                //传递数据和第一级ul
                dataSeparation(_this.data, _this.div.getElementsByTagName('ul')[0]);
            })
        }

        function clickUl(div){
            var _this = this;
            //采用事件委托，将事件委托给div
            div.addEventListener('click',function(e){
                var tar = e.target;
                if(tar.nodeName.toLowerCase() == 'li'){
                    let ul = tar.parentNode;
                    //将点击的li序号，及其父节点的序号传给函数判断
                    judgeUl(tar.index,ul.index);
                    setSelectAttr(tar.index,ul.index);
                }
            })
        }

        //判断当前点击的li及ul
        function judgeUl(tarIndex,ulIndex){
            var data,ul;
            var ulList = this.div.getElementsByTagName('ul');

            if(ulIndex == 0){
                //当重新选择第一个ul时，把第三个ul清空
                while(ulList[2].firstChild){
                    ulList[2].removeChild(ulList[2].firstChild);
                }
                tarIndex1 = tarIndex;
                data = this.data[tarIndex1].children;
                ul = ulList[1];
                dataSeparation(data,ul); 
                this.resLocation[0] = this.data[tarIndex1].name;
            }else if(ulIndex == 1){
                tarIndex2 = tarIndex;
                data = this.data[tarIndex1].children[tarIndex2].children;
                ul = ulList[2];
                dataSeparation(data,ul);
                this.resLocation[1] = this.data[tarIndex1].children[tarIndex2].name;
            }else if(ulIndex == 2){
                this.resLocation[2] = this.data[tarIndex1].children[tarIndex2].children[tarIndex].name;
                console.log(this.resLocation.join(''));
                this.div.getElementsByTagName('input')[0].value = this.resLocation.join('');
                for(let i = 0; i < 3; i++){
                	while(ulList[i].firstChild){
                		ulList[i].removeChild(ulList[i].firstChild);
                	}
                }
            }

        }
        //由于每次点击li出现新的ul时，只需要数据和用于显示的ul，所以将data和ul作为参数。
        function dataSeparation(data,ul){

            while(ul.firstChild){
                ul.removeChild(ul.firstChild);
            }

            for(let i = 0; i < data.length; i++){
                let li = document.createElement('li');
                li.innerText = data[i].name;
                li.index = i;
                ul.appendChild(li);
            }
        }

        //设置选择属性
        function setSelectAttr(tarIndex, ulIndex){
            var ulList = this.div.getElementsByTagName('ul');
            console.log('attr',ulList[0].children[0]);

            if(ulIndex == 0){
                ulList[0].children[lastUl0Index].removeAttribute('class');
                ulList[0].children[tarIndex].setAttribute('class','selected');
                lastUl0Index = tarIndex;
            }else if(ulIndex == 1){
                ulList[1].children[lastUl1Index].removeAttribute('class');
                ulList[1].children[tarIndex].setAttribute('class','selected');
                lastUl1Index = tarIndex;
            }
        }
        this.init();
	}
</script>
</body>
</html>